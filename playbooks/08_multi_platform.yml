# ansible n1 -m file -a "path=/home/ec2-user/new-dir state=directory"
---
- name: Install Apache2 server
  hosts: g1
  become: yes

  pre_tasks:
    - name: upgrade all packages
      dnf5:
        update_only: yes
        update_cache: yes
      when: ansible_os_family == "RedHat"

    - name: upgrade all packages
      apt:
        update_only: yes
        update_cache: yes
      when: ansible_os_family == "Ubuntu"

  tasks:
    - name: Install Apache for ubuntu and red-hat
      tags: always
      dnf5:
        name: "{{apache_package}}"
        state: present
      when: ansible_distribution == "RedHat"

    - name: Install Apache for ubuntu and red-hat
      tags: always
      apt:
        name: "{{apache_package}}"
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Start and enable httpd (red-hat, amazon and centos).
      tags: apache,red-hat,httpd, fedora, amazon
      service:
        name: httpd
        state: started
        enabled: yes
      when: ansible_distribution == "RedHat"

    - name: Start and Enable Apache2 (ubuntu)
      tags: apache,ubuntu,apache2
      service:
        name: apache2
        state: started
        enabled: yes
      when: ansible_os_family == "Ubuntu"
...